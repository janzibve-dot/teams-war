<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>TEAMS WAR | GLOBAL FORUM (forv12)</title>
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <style>
        @font-face { font-family: 'Sangyo'; src: url('ofont.ru_Sangyo.ttf') format('truetype'); }
        :root { --bg-black: #050505; --block-bg: #0d0d0d; --custom-green: #777c4e; --custom-red: #bc0000; --border-glow: rgba(188, 0, 0, 0.4); --font-main: 'Sangyo', sans-serif; }
        * { box-sizing: border-box; }
        body { background-color: var(--bg-black); color: white; margin: 0; font-family: var(--font-main); text-transform: uppercase; overflow-x: hidden; }
        header { position: sticky; top: 0; padding: 20px 40px; background: #000; border-bottom: 3px solid var(--custom-red); display: flex; align-items: center; justify-content: space-between; }
        .main-layout { display: grid; grid-template-columns: 1fr 350px; gap: 30px; padding: 40px; }
        .category-card, .sidebar-block { background: var(--block-bg); border: 1px solid var(--custom-red); box-shadow: 0 0 10px var(--border-glow); border-radius: 8px; padding: 20px; margin-bottom: 15px; }
        .mini-chat { height: 350px; overflow-y: auto; font-family: sans-serif; font-size: 13px; margin-bottom: 10px; border-bottom: 1px solid #222; }
        .chat-msg { margin-bottom: 10px; border-left: 2px solid var(--custom-green); padding-left: 10px; text-transform: none; }
        .chat-input { background: #000; border: 1px solid var(--custom-red); color: white; width: 100%; padding: 12px; }
        .exit-btn { position: fixed; bottom: 30px; right: 30px; background: var(--custom-red); color: white; border: none; padding: 12px 25px; border-radius: 30px; font-weight: bold; cursor: pointer; z-index: 5000; }
    </style>
</head>
<body>
    <header>
        <div style="font-size:28px;"><span style="color:var(--custom-green)">TEAMS</span> <span style="color:var(--custom-red)">WAR</span></div>
        <div id="status" style="color:gray; font-size:12px;">ПОДКЛЮЧЕНИЕ...</div>
    </header>
    <main class="main-layout">
        <section>
            <div style="font-size:18px; font-weight:bold; margin-bottom:25px;">РАЗДЕЛЫ ФОРУМА</div>
            <div class="category-card">НОВОСТИ ИГРЫ</div>
            <div class="category-card">ТЕХНИЧЕСКАЯ ПОДДЕРЖКА</div>
        </section>
        <aside>
            <div class="sidebar-block">
                <div style="font-size:14px; font-weight:bold; margin-bottom:15px;">ОБЩИЙ ЧАТ</div>
                <div class="mini-chat" id="chat-win"></div>
                <input type="text" id="chat-inp" class="chat-input" placeholder="СООБЩЕНИЕ... (ENTER)" onkeydown="if(event.key==='Enter') send()">
            </div>
        </aside>
    </main>
    <button class="exit-btn" onclick="window.parent.postMessage('closeForum', '*')">ВЫХОД</button>

    <script>
        // ГЛОБАЛЬНЫЙ ЧАТ (forv12)
        const gun = Gun(['https://gun-manhattan.herokuapp.com/gun', 'https://gun-us.herokuapp.com/gun']);
        const chat = gun.get('teams_war_global_v12_final'); // Уникальный ключ для связи
        const myNick = "БОЕЦ_" + Math.floor(Math.random() * 999);

        function send() {
            const inp = document.getElementById('chat-inp');
            if(inp.value.trim()){
                chat.set({ n: myNick, t: inp.value, d: Date.now() });
                inp.value = "";
            }
        }

        chat.map().on((data, id) => {
            if(!data || !data.t || document.getElementById(id)) return;
            const msg = document.createElement('div');
            msg.id = id;
            msg.className = 'chat-msg';
            msg.innerHTML = `<b>${data.n}</b>: ${data.t}`;
            document.getElementById('chat-win').appendChild(msg);
            document.getElementById('status').innerText = "В СЕТИ";
            document.getElementById('status').style.color = "#777c4e";
            document.getElementById('chat-win').scrollTop = 9999;
        });
    </script>
</body>
</html>
